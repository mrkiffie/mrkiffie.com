<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Newlines and Version Control | mrkiffie.com</title><meta name="author" content="mrkiffie"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="https://mrkiffie.com/2016/newlines-and-version-control/"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="/assets/css/styles-e1534e338bd1dccc27b78e3447a8bf0a.css" media="all"><link rel="stylesheet" href="/assets/css/prism-0b5b171f3e7a65dc20dfe14fea81d83f.css" media="all"><link rel="stylesheet" href="/assets/css/fancy-quotes-2ace9dc0eff0e95e670a6a4e3710941e.css" media="all"></head><body><header role="banner"><h1><a href="/" title="mrkiffie.com" class="logo"><img src="/assets/img/kiffie-331e39a08b644e1226a240c052780d69.jpg" alt="mrkiffie.com" width="288" height="288"></a></h1></header><main role="main"><article><header><time datetime="2016-04-27">27 Apr 2016</time><h1>Newlines and Version Control</h1></header><p>Imagine you have just finished implementing a new feature in a project and before committing the work to the repo, want to see a summary of the changes. Running <code>git diff</code> reveals the expected changes, but you also see the strange message:</p><blockquote><p>No newline at end of file.</p></blockquote><p>OK, so there is no newline at end of file&#x2026; What is the big deal?</p><p><em>Aside:</em> I would recommend reading <a href="http://blog.codinghorror.com/the-great-newline-schism/">The Great Newline Schism</a> by Jeff Atwood to clear up any misunderstanding about <a href="https://en.wikipedia.org/wiki/Carriage_return">carriage return</a> and <a href="https://en.wikipedia.org/wiki/Newline">line feed</a> before continuing&#x2026;</p><p>For the purpose of clarity, we&apos;ll be using <code>\n</code> for newlines characters - it is a common abstraction in many programming languages for newlines.</p><h2 id="no-newline-at-end-of-file">No newline at end of file</h2><p>The message indicates that you do not have a newline at the end of the file. You may be asking:</p><blockquote><p>So what is the significance?</p></blockquote><p>Let&apos;s do a little experimenting on the command line to see how <code>git</code> handles things:</p><h3 id="newline-experiment">Newline Experiment</h3><h4 id="part-1-adding-content-without-a-newline">Part 1 - Adding content without a newline</h4><ol><li><p>We will start by creating a new directory for our experiment.</p></li><li><p>In this new directory we will create an empty <code>git</code> repository by typing <code>git init</code>.</p></li><li><p>Now we will create an empty file called <code>foo.txt</code> using <code>touch foo.txt</code>.</p></li><li><p>Staging the empty file in the <code>git</code> repository will allow us to compare upcoming changes against it. Stage the file using <code>git add foo.txt</code>.</p></li><li><p>Add &quot;Hello&quot; to the file - <code>printf &apos;Hello&apos; &gt;&gt; foo.txt</code>. We are explicitly adding the text <strong>without</strong> a new line at the end. <code>echo</code> adds a newline by default. <code>printf</code> does not add a newline by default.</p></li><li><p>Now that we have added some content we can see what the diff generates. Running <code>git diff</code> will output the following:</p></li></ol><pre><code class="language-diff">diff --git a/foo.txt b/foo.txt
index e69de29..5ab2f8a 100644
<span class="token coord">--- a/foo.txt</span>
<span class="token coord">+++ b/foo.txt</span>
<span class="token coord">@@ -0,0 +1 @@</span>
<span class="token inserted">+Hello</span>
\ No newline at end of file
</code></pre><p><strong>Notice</strong> the <code>\ No newline at end of file</code> message below the &quot;Hello&quot;.</p><p>The diff&apos;s output is rendered <strong>with</strong> a newline at the end of the &quot;Hello&quot; to make it easier to consume programmatically.<br>The <code>No newline at end of file</code> message is appended to indicate that the newline is actually missing from that file.</p><p>A newline character is always at the end of the line.</p><p>Newlines are a <a href="https://en.wikipedia.org/wiki/Control_character">control character</a> and therefore don&apos;t have a visible character. Certain editors may display a character to show that there is a newline, others will show the next line number and some will not show anything.</p><p>OK, let&apos;s get back to this experiment</p><h4 id="part-2-adding-content-after-a-missing-newline">Part 2 - Adding content after a missing newline</h4><ol><li><p>Let&apos;s stage the file again so we can see the effect of adding more lines - <code>git add foo.txt</code></p></li><li><p>This time we will add &quot;World&quot; on a newline - <code>printf &apos;\nWorld\n&apos; &gt;&gt; foo.txt</code>. Note how we have added <code>\n</code> before and after &quot;World&quot;.</p></li><li><p>What is the diff now? - <code>git diff</code></p></li></ol><pre><code class="language-diff">diff --git a/foo.txt b/foo.txt
index 5ab2f8a..f9264f7 100644
<span class="token coord">--- a/foo.txt</span>
<span class="token coord">+++ b/foo.txt</span>
<span class="token coord">@@ -1 +1,2 @@</span>
<span class="token deleted">-Hello</span>
\ No newline at end of file
<span class="token inserted">+Hello</span>
<span class="token inserted">+World</span>
</code></pre><p>The diff reveals the following:</p><ul><li><p>We have explicitly added a newline character to the end of &quot;Hello&quot;. This newline character is residing at the end of the first line. The first line shows up in the diff as modified although there is no visible change. The &quot;No newline at end of file&quot; from the previous set of changes is gone.</p></li><li><p>We also added an explicit newline character after &quot;World&quot;. There is no &quot;No newline at end of file&quot; after the second line.</p></li></ul><blockquote><p>What about adding another line?</p></blockquote><p>OK, lets see what happens when we add another line.</p><h4 id="part-3-adding-content-after-a-newline">Part 3 - Adding content after a newline</h4><ol><li><p>We will stage the current changes so we can get a clean diff - <code>git add foo.txt</code></p></li><li><p>Let us add &quot;!&quot; on the third line - <code>echo &apos;!&apos; &gt;&gt; foo.txt</code>. We use echo here to get the benefit of appending a newline character by default.</p></li><li><p>Now we can have a look at the diff</p></li></ol><pre><code class="language-diff">diff --git a/foo.txt b/foo.txt
index f9264f7..a9a7f7a 100644
<span class="token coord">--- a/foo.txt</span>
<span class="token coord">+++ b/foo.txt</span>
<span class="token coord">@@ -1,2 +1,3 @@</span>
 Hello
 World
<span class="token inserted">+!</span>
</code></pre><p>The diff above shows that the second line was not modified. We have successfully appended to the file without other modifications. We did not need to append a newline to the second line to create the third line.</p><p>That is a much cleaner diff. The intent is clearly conveyed.</p><p>OK, there is just one thing missing&#x2026;</p><h4 id="part-4-preparing-a-patch">Part 4 - Preparing a patch</h4><ol><li><p>Stage the most recent changes again - <code>git add foo.txt</code></p></li><li><p>We will now apply a patch using an existing diff. Create a new file called <code>add-beautiful.diff</code> and add following snippet to it.</p></li></ol><pre><code class="language-diff">diff --git a/foo.txt b/foo.txt
index a9a7f7a..9a4c951 100644
<span class="token coord">--- a/foo.txt</span>
<span class="token coord">+++ b/foo.txt</span>
<span class="token coord">@@ -1,3 +1,4 @@</span>
 Hello
<span class="token inserted">+Beautiful</span>
 World
 !
</code></pre><p><strong>Note:</strong> We can generate our own patch by using the output generated by <code>git diff</code> and send the output to a file - <code>git diff &gt;&gt; &lt;filename&gt;</code>.</p><h4 id="part-5-apply-a-patch">Part 5 - Apply a patch</h4><ol><li><p>Now we can apply the patch which will update our <code>foo.txt</code>. To do this we use <code>git apply add-beautiful.diff</code></p></li><li><p>If we now do diff - <code>git diff</code></p></li></ol><pre><code class="language-diff">diff --git a/foo.txt b/foo.txt
index a9a7f7a..9a4c951 100644
<span class="token coord">--- a/foo.txt</span>
<span class="token coord">+++ b/foo.txt</span>
<span class="token coord">@@ -1,3 +1,4 @@</span>
 Hello
<span class="token inserted">+Beautiful</span>
 World
 !
</code></pre><p><strong>Notice</strong> how the output is the same as was the patch we applied.</p><p>This is <strong>not</strong> a coincidence. Remember that a diff is a format that can easily be consumed programmatically.</p><h3 id="my-take-on-it">My take on it</h3><p>&quot;No newline at end of file&quot;, like other whitespace changes, add unnecessary noise to commits and diffs. It should be avoided and is fairly easy to avoid.</p><p>Managing different configurations across different projects can be tedious. The solution that I&apos;ve found most helpful is adding a <a href="http://editorconfig.org/"><code>.editorconfig</code></a> file to a project and installing the <a href="http://editorconfig.org/#download">EditorConfig plugins</a> corresponding to my editors.</p><h2 id="conclusion">Conclusion</h2><p>Commands that we have covered during this post:</p><ul><li><p><code>git init</code> creates an empty git repository.</p></li><li><p><code>touch &lt;filename&gt;</code> creates a blank file with the given name.</p></li><li><p><code>git add &lt;filename&gt;</code> will stage the file. This is normally used as a way to add certain changes to particular commits. We have misused it to generate diffs by comparing the unstaged changes against the staged changes.</p></li><li><p><code>printf</code> does <strong>not</strong> include a newline character at the end of the content by default.</p></li><li><p><code>echo</code> does include a newline character at the end of the content by default.</p></li><li><p><code>git diff</code> compares unstaged changes against the staged files (If there are no staged files, it defaults to the previous commit).</p></li><li><p><code>git apply</code> allowed us to apply a patch on our files. It is important to note that the file extension <code>.diff</code> is only a convention and does not impact <code>git</code>&apos;s ability to use it.</p></li></ul><p>So hopefully you now have a better understanding of why <code>git</code> keeps pointing out the &quot;No newline at end of file&quot;.</p><p>Now go out and enjoy the beautiful world!</p></article></main><hr class="screen-reader-text"><footer role="contentinfo"><ul><li><a href="/" title="Go to the home page">Home</a></li><li><a href="/about/" title="Information about me">About</a></li><li><a href="http://codepen.io/mrkiffie" title="View some of my creations on Codepen">Codepen</a></li><li><a href="https://github.com/mrkiffie" title="Follow my involvement in various open source projects on Github">Github</a></li></ul><small><span>-- .- -.. .</span> &nbsp;&nbsp; <span>.-- .. - ....</span> &nbsp;&nbsp; <span>.-.. --- ...- .</span></small><p>&copy;<span class="screen-reader-text">Copyright</span> 2011-2016 Kiffie&nbsp;Liversage</p></footer><script src="/assets/js/main-86dcd09ef150f541e3afa2c9e9a30a26.js"></script><script>(function(s,i,m,p,l,e,r){s['GoogleAnalyticsObject']=l;s[l]=s[l]||function(){(s[l].q=s[l].q||[]).push(arguments)},s[l].l=1*new Date();e=i.createElement(m),r=i.getElementsByTagName(m)[0];e.async=1;e.src=p;r.parentNode.insertBefore(e,r)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-24126980-1','auto');ga('send','pageview');</script></body></html>